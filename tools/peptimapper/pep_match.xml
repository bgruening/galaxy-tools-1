<tool id="peptimapper_pep_match" name="PepMatch" version="2.1">
    <description>align PSTs on sequence and cluster hits</description>
    <requirements>
        <container type="docker">dockerprotim/peptimapper@sha256:d3eb807d7d5aa155f7b39d05a47420e0a0a9191d5fa867b6ca1be763f8a23bf1</container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
ln -s '$fastafile' 'in.fa' &&
ln -s '$tagsfile' 'in.tags' &&
LXRunPepMatch -D $D -t $t -T $T -d $d 'in.fa' 'in.tags' &&
mv 'in.tags.in.fa.trans.${D}.hit' '${hitsfile}' &&
mv 'in.tags.in.fa.trans.${D}.hit.${t}.${T}.${d}.clust' '${clustersfile}'
    ]]></command>
    <inputs>
        <param name="tagsfile" type="data" format="txt" label="PSTs file (Text)" help="Peptide sequence tags file generated by PepnovoTag" />
        <param name="fastafile" type="data" format="fasta" label="Chromosome file (Fasta)" help="Chromosome file" />

        <param name="D" type="select" label="Mass tolerance" help="uma">
            <option value="0.5" selected="true">0.5</option>
            <option value="0.25">0.25</option>
            <option value="0.025">0.025</option>
            <option value="0.0025">0.0025</option>
            <option value="0">0</option>
        </param>

        <param name="t" type="select" label="Min. hits" help="Minimal hits number per cluster">
            <option value="2" selected="true">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </param>

        <param name="T" type="select" label="Min. peptides" help="Minimal peptides number per cluster">
            <option value="2" selected="true">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </param>

        <param name="d" type="select" label="Distance" help="Maximum distance between two hits to be clustered">
            <option value="500">500</option>
            <option value="1000">1000</option>
            <option value="2000">2000</option>
            <option value="5000" selected="true">5000</option>
            <option value="10000">10000</option>
            <option value="15000">15000</option>
            <option value="20000">20000</option>
            <option value="50000">50000</option>
            <option value="80000">80000</option>
            <option value="100000">100000</option>
            <option value="120000">120000</option>
        </param>
    </inputs>

    <outputs>
        <data format="txt" name="hitsfile" label="${tagsfile.element_identifier}.${fastafile.element_identifier}.${D}.hit"/>
        <data format="txt" name="clustersfile" label="${tagsfile.element_identifier}.${fastafile.element_identifier}.${D}.hit.${t}.${T}.${d}.clust"/>
    </outputs>
    <tests>
        <test>
            <param name="tagsfile" value="pepnovotag/sample_02.mgf.3.5.tag"/>
            <param name="fastafile" value="pepmatch/Nuc_genome_small.fasta"/>
            <param name="D" value="0.5"/>
            <param name="t" value="2"/>
            <param name="T" value="2"/>
            <param name="d" value="5000"/>
            <output name="hitsfile" file="pepmatch/sample_02.mgf.3.5.tag.Nuc_genome_small.fasta.0.5.hit"/>
            <output name="clustersfile" file="pepmatch/sample_02.mgf.3.5.tag.Nuc_genome_small.fasta.0.5.hit.2.2.5000.clust"/>
        </test>
    </tests>
    <help><![CDATA[
**Description**

PepMatch : run LXRunPepMatch from peptimapper docker. It translates chromosome sequence into six-frame translations, aligns PSTs and clusters hits. PepMatch outputs are a hits (or PST locations) file on the genome and a clusters (hits list per cluster) file. PepMatch clusters results are compatible with ClustQualify and ClustToGff to be annotated and analysed into a genome viewer.

It is based on the PepLine software developed by Ferro and collaborators
Ferro, M., Tardif, M., Reguer, E., Cahuzac, R., Bruley, C., Vermat, T., Nugues, E., Vigouroux, M., Vandenbrouck, Y., Garin, J. & Viari, A. 2008. PepLine: a software pipeline for high-throughput direct mapping of tandem mass spectrometry data on genomic sequences. J Proteome Res 7:1873-83.

**Integrated by**

Laetitia Guillot Cloarec
PROTIM Biogenouest proteomics Core Facility, Rennes
May,2016
    ]]></help>
    <citations>
        <citation type="bibtex">
            @misc{renameTODO,
            author = {Protim Core facility},
            year = {2016},
            title = {PepMatch},
            url = {protim.eu},
            }
        </citation>
    </citations>
</tool>
